# -*- coding: utf-8 -*-
"""
æµ‹è¯•ä¿®æ”¹åçš„NC.pyè®¡ç®—é€»è¾‘ï¼Œå¹¶è§£é‡ŠNCå€¼ä¸åƒç´ åŒ¹é…ç‡çš„å·®å¼‚
"""

import numpy as np
from NC import NC

def explain_nc_vs_pixel_match():
    """
    è¯¦ç»†è§£é‡ŠNCå€¼å’Œåƒç´ åŒ¹é…ç‡çš„å·®å¼‚
    """
    print("=" * 80)
    print("NCå€¼ vs åƒç´ åŒ¹é…ç‡ - å·®å¼‚è§£é‡Š")
    print("=" * 80)
    
    print("\nğŸ“– ç†è®ºåŸºç¡€ï¼š")
    print("-" * 50)
    print("1. NCå€¼ (æ ‡å‡†åŒ–ç›¸å…³ç³»æ•°):")
    print("   å…¬å¼: NC = Î£(x*y) / sqrt(Î£(xÂ²) * Î£(yÂ²))")
    print("   å«ä¹‰: è¡¡é‡ä¸¤ä¸ªä¿¡å·çš„ç›¸å…³æ€§ï¼Œè€ƒè™‘ä¿¡å·çš„å¹…åº¦å’Œåˆ†å¸ƒ")
    print("   ç‰¹ç‚¹: å¯¹å¹…åº¦å˜åŒ–æ•æ„Ÿï¼ŒèŒƒå›´ [-1, 1]ï¼Œ1è¡¨ç¤ºå®Œå…¨æ­£ç›¸å…³")
    
    print("\n2. åƒç´ åŒ¹é…ç‡:")
    print("   å…¬å¼: åŒ¹é…ç‡ = ç›¸åŒåƒç´ æ•° / æ€»åƒç´ æ•° Ã— 100%")
    print("   å«ä¹‰: è¡¡é‡ä¸¤ä¸ªå›¾åƒé€åƒç´ ç›¸åŒçš„æ¯”ä¾‹")
    print("   ç‰¹ç‚¹: åªè€ƒè™‘ä½ç½®å¯¹åº”çš„åƒç´ æ˜¯å¦ç›¸ç­‰ï¼ŒèŒƒå›´ [0%, 100%]")
    
    print("\nğŸ” å…³é”®å·®å¼‚ï¼š")
    print("-" * 50)
    print("â€¢ NCå€¼è€ƒè™‘åƒç´ å€¼çš„åˆ†å¸ƒå’Œç›¸å…³æ€§")
    print("â€¢ åƒç´ åŒ¹é…ç‡åªè€ƒè™‘åƒç´ å€¼æ˜¯å¦å®Œå…¨ç›¸ç­‰")
    print("â€¢ NCå€¼å¯¹å™ªå£°æ›´æ•æ„Ÿï¼Œåƒç´ åŒ¹é…ç‡å¯¹å±€éƒ¨å·®å¼‚æ›´æ•æ„Ÿ")
    
    # åˆ›å»ºæµ‹è¯•ç”¨ä¾‹
    print("\nğŸ“Š æµ‹è¯•ç”¨ä¾‹æ¼”ç¤ºï¼š")
    print("=" * 80)
    
    # æµ‹è¯•ç”¨ä¾‹1ï¼šå®Œå…¨ç›¸åŒ
    print("\nã€æµ‹è¯•1ï¼šå®Œå…¨ç›¸åŒçš„å›¾åƒã€‘")
    img1 = np.array([[1, 0, 1, 0],
                     [0, 1, 0, 1],
                     [1, 0, 1, 0],
                     [0, 1, 0, 1]])
    img2 = img1.copy()
    
    nc_val = NC(img1, img2)
    pixel_match = np.sum(img1 == img2) / img1.size * 100
    
    print(f"åŸå§‹å›¾åƒ:\n{img1}")
    print(f"å¯¹æ¯”å›¾åƒ:\n{img2}")
    print(f"NCå€¼: {nc_val:.6f}")
    print(f"åƒç´ åŒ¹é…ç‡: {pixel_match:.2f}%")
    print("ç»“è®º: å®Œå…¨ç›¸åŒæ—¶ï¼ŒNCå€¼=1ï¼Œåƒç´ åŒ¹é…ç‡=100%")
    
    # æµ‹è¯•ç”¨ä¾‹2ï¼šéƒ¨åˆ†ä¸åŒ
    print("\nã€æµ‹è¯•2ï¼šéƒ¨åˆ†åƒç´ ä¸åŒã€‘")
    img3 = np.array([[1, 0, 1, 0],
                     [0, 1, 0, 1],
                     [1, 0, 0, 0],  # è¿™ä¸€è¡Œæœ‰å˜åŒ–
                     [0, 1, 0, 1]])
    
    nc_val = NC(img1, img3)
    pixel_match = np.sum(img1 == img3) / img1.size * 100
    diff_pixels = np.sum(img1 != img3)
    
    print(f"åŸå§‹å›¾åƒ:\n{img1}")
    print(f"å¯¹æ¯”å›¾åƒ:\n{img3}")
    print(f"ä¸åŒåƒç´ æ•°: {diff_pixels}/16")
    print(f"NCå€¼: {nc_val:.6f}")
    print(f"åƒç´ åŒ¹é…ç‡: {pixel_match:.2f}%")
    print("ç»“è®º: 1ä¸ªåƒç´ ä¸åŒï¼Œåƒç´ åŒ¹é…ç‡é™è‡³93.75%ï¼Œä½†NCå€¼ä»ç„¶è¾ƒé«˜")
    
    # æµ‹è¯•ç”¨ä¾‹3ï¼šåè½¬å›¾åƒ
    print("\nã€æµ‹è¯•3ï¼šå®Œå…¨åè½¬çš„å›¾åƒã€‘")
    img4 = 1 - img1  # 0å˜1ï¼Œ1å˜0
    
    nc_val = NC(img1, img4)
    pixel_match = np.sum(img1 == img4) / img1.size * 100
    
    print(f"åŸå§‹å›¾åƒ:\n{img1}")
    print(f"åè½¬å›¾åƒ:\n{img4}")
    print(f"NCå€¼: {nc_val:.6f}")
    print(f"åƒç´ åŒ¹é…ç‡: {pixel_match:.2f}%")
    print("ç»“è®º: å®Œå…¨åè½¬æ—¶ï¼ŒNCå€¼ä¸ºè´Ÿï¼Œåƒç´ åŒ¹é…ç‡=0%")
    
    # æµ‹è¯•ç”¨ä¾‹4ï¼šåŠæ•°ç›¸åŒ
    print("\nã€æµ‹è¯•4ï¼šä¸€åŠåƒç´ ç›¸åŒã€‘")
    img5 = np.array([[1, 0, 0, 1],  # å‰ä¸¤è¡Œæ”¹å˜
                     [1, 0, 1, 0],
                     [1, 0, 1, 0],  # åä¸¤è¡Œä¸å˜
                     [0, 1, 0, 1]])
    
    nc_val = NC(img1, img5)
    pixel_match = np.sum(img1 == img5) / img1.size * 100
    same_pixels = np.sum(img1 == img5)
    
    print(f"åŸå§‹å›¾åƒ:\n{img1}")
    print(f"å¯¹æ¯”å›¾åƒ:\n{img5}")
    print(f"ç›¸åŒåƒç´ æ•°: {same_pixels}/16")
    print(f"NCå€¼: {nc_val:.6f}")
    print(f"åƒç´ åŒ¹é…ç‡: {pixel_match:.2f}%")
    print("ç»“è®º: ä¸€åŠåƒç´ ç›¸åŒæ—¶ï¼ŒNCå€¼å’Œåƒç´ åŒ¹é…ç‡éƒ½ä½“ç°äº†50%çš„ç›¸ä¼¼æ€§")
    
    print("\n" + "=" * 80)
    print("ğŸ’¡ æ€»ç»“")
    print("=" * 80)
    print("1. NCå€¼é€‚åˆè¯„ä¼°ä¿¡å·æ•´ä½“ç›¸å…³æ€§ï¼Œå¯¹æ¨¡å¼è¯†åˆ«æ›´æœ‰æ„ä¹‰")
    print("2. åƒç´ åŒ¹é…ç‡é€‚åˆè¯„ä¼°å›¾åƒç²¾ç¡®å¤åˆ¶ç¨‹åº¦")
    print("3. åœ¨æ°´å°åº”ç”¨ä¸­ï¼ŒNCå€¼æ›´èƒ½åæ˜ æ°´å°çš„å¯è¯†åˆ«æ€§")
    print("4. åƒç´ åŒ¹é…ç‡æ›´èƒ½åæ˜ æ•°æ®çš„å®Œæ•´æ€§")
    print("5. ä¸¤ä¸ªæŒ‡æ ‡ç»“åˆä½¿ç”¨èƒ½æ›´å…¨é¢åœ°è¯„ä¼°å›¾åƒè´¨é‡")

def test_nc_calculation():
    """
    æµ‹è¯•ä¿®æ”¹åçš„NCè®¡ç®—æ˜¯å¦æ­£ç¡®
    """
    print("\n" + "=" * 80)
    print("NCè®¡ç®—é€»è¾‘éªŒè¯")
    print("=" * 80)
    
    # æ‰‹å·¥è®¡ç®—éªŒè¯
    print("\nğŸ§® æ‰‹å·¥è®¡ç®—éªŒè¯ï¼š")
    print("-" * 50)
    
    # ç®€å•çš„2x2æµ‹è¯•ç”¨ä¾‹
    mark_prime = np.array([[1, 0],    # åŸå§‹æ°´å°
                          [1, 1]], dtype=float)
    mark_get = np.array([[1, 0],      # æå–æ°´å°  
                        [0, 1]], dtype=float)
    
    print(f"åŸå§‹æ°´å° (mark_prime):\n{mark_prime}")
    print(f"æå–æ°´å° (mark_get):\n{mark_get}")
    
    # æ‰‹å·¥è®¡ç®—
    fenzi_manual = 1*1 + 0*0 + 1*0 + 1*1  # æ¯ä¸ªä½ç½®ç›¸ä¹˜å†æ±‚å’Œ
    fenmu1_manual = 1*1 + 0*0 + 0*0 + 1*1  # mark_getå¹³æ–¹å’Œ
    fenmu2_manual = 1*1 + 0*0 + 1*1 + 1*1  # mark_primeå¹³æ–¹å’Œ
    nc_manual = fenzi_manual / np.sqrt(fenmu1_manual * fenmu2_manual)
    
    print(f"\næ‰‹å·¥è®¡ç®—è¿‡ç¨‹ï¼š")
    print(f"fenzi (åˆ†å­) = 1Ã—1 + 0Ã—0 + 1Ã—0 + 1Ã—1 = {fenzi_manual}")
    print(f"fenmu1 (mark_getå¹³æ–¹å’Œ) = 1Â² + 0Â² + 0Â² + 1Â² = {fenmu1_manual}")
    print(f"fenmu2 (mark_primeå¹³æ–¹å’Œ) = 1Â² + 0Â² + 1Â² + 1Â² = {fenmu2_manual}")
    print(f"NC = {fenzi_manual} / sqrt({fenmu1_manual} Ã— {fenmu2_manual}) = {nc_manual:.6f}")
    
    # å‡½æ•°è®¡ç®—
    nc_function = NC(mark_prime, mark_get)
    print(f"\nå‡½æ•°è®¡ç®—ç»“æœ: {nc_function:.6f}")
    
    # éªŒè¯ç»“æœ
    if abs(nc_manual - nc_function) < 1e-10:
        print("âœ… è®¡ç®—ç»“æœä¸€è‡´ï¼Œä¿®æ”¹åçš„NCå‡½æ•°é€»è¾‘æ­£ç¡®ï¼")
    else:
        print("âŒ è®¡ç®—ç»“æœä¸ä¸€è‡´ï¼Œéœ€è¦æ£€æŸ¥å‡½æ•°é€»è¾‘")
        print(f"å·®å¼‚: {abs(nc_manual - nc_function)}")

def main():
    """
    ä¸»å‡½æ•°
    """
    print("ğŸ” NCå€¼è®¡ç®—é€»è¾‘æµ‹è¯•ä¸NCå€¼/åƒç´ åŒ¹é…ç‡å·®å¼‚è§£é‡Š")
    print("æŒ‰ç…§NC.mçš„é€»è¾‘ä¿®æ”¹NC.pyåçš„éªŒè¯")
    
    # æµ‹è¯•NCè®¡ç®—é€»è¾‘
    test_nc_calculation()
    
    # è§£é‡ŠNCå€¼å’Œåƒç´ åŒ¹é…ç‡çš„å·®å¼‚
    explain_nc_vs_pixel_match()
    
    print("\nğŸ¯ ä¿®æ”¹æ€»ç»“ï¼š")
    print("=" * 80)
    print("1. âœ… å·²æŒ‰ç…§NC.mçš„é€»è¾‘ä¿®æ”¹NC.py")
    print("2. âœ… ç§»é™¤äº†ä¸å¿…è¦çš„äºŒå€¼å›¾åƒæ£€æŸ¥")
    print("3. âœ… ç§»é™¤äº†é›¶å€¼ç‰¹æ®Šå¤„ç†")
    print("4. âœ… ç§»é™¤äº†ç²¾åº¦ä¿®æ­£ (ä¿æŒä¸MATLABä¸€è‡´)")
    print("5. âœ… é‡‡ç”¨åŒé‡å¾ªç¯æ–¹å¼è®¡ç®— (ä¸MATLABå®Œå…¨ä¸€è‡´)")
    print("6. âœ… ä½¿ç”¨ç›¸åŒçš„å˜é‡å‘½å (fenzi, fenmu1, fenmu2)")
    print("\nç°åœ¨NC.pyçš„è®¡ç®—é€»è¾‘ä¸NC.må®Œå…¨ä¸€è‡´ï¼")

if __name__ == "__main__":
    main()
